<html>
<head>
    <!-- jQuery -->
    <script src="/static/bower/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="/static/bower/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- PatternFly -->
    <link href="/static/bower/patternfly/dist/css/patternfly.min.css" rel="stylesheet" media="screen, print">
    <link href="/static/bower/patternfly/dist/css/patternfly-additions.min.css" rel="stylesheet" media="screen, print">
    <!-- Fork me on Github ribbon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
    <title>Review queue for {{ user }}</title>
</head>

<body class="cards-pf container-cards-pf">
  <a class="github-fork-ribbon" href="https://github.com/vrutkovs/github-review-dashboard" title="Fork me on GitHub" target="_blank">Fork me on GitHub</a>
  <h1 id="headline" class="text-center">Building a PR review queue for {{user}}, please wait...</h1>
  <div id='cards' class="container-fluid container-cards-pf">
  </div>

  <div class="text-muted pull-right">{% include 'commit.jinja2' %}</div>

  <script>
    $(document).ready(function() {
      // Load cards from websocket
      var row_id = -1;
      var card_id = 0;
      var row_obj;
      var sock = new WebSocket('ws://' + window.location.host + '{{ws_url}}')
      sock.onmessage = function(event) {
        if (event.data != 'end') {
          if (Math.floor(card_id / 2) != row_id) {
            row_obj = $('#cards').append(row_str = '<div class="row row-cards-pf">');
            row_id++;
          }
          row_obj.append(event.data);
          card_id++;
        } else {
          // Chnage the headline when loading is done
          if (card_id == 0) {
            $('#headline').text('PR review queue is empty. Good job!');
          } else {
            $('#headline').text('PR review queue for {{user}}');

            // Open PR link when a card is clicked
            $(".card-pf").click(function(e){
              var target = e.target;
              window.open($(this).data("link"));
            });
          }
        }
      };
      sock.onopen = function(){
        sock.send("ready");
      };
    });
  </script>
</body>
</html>
